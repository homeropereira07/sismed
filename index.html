<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Prescri√ß√£o M√©dica - Login</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }
        
        .login-container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 2.5rem;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }
        
        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.25);
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        
        button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
            width: 100%;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .footer {
            margin-top: 1.5rem;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .error-message {
            color: var(--accent);
            margin-top: 0.5rem;
            font-size: 0.9rem;
            display: none;
        }
        
        .login-header {
            margin-bottom: 2rem;
        }
        
        .login-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }
        
        .license-message {
            display: none;
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            text-align: left;
        }
        
        .license-message h3 {
            color: #856404;
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }
        
        .license-message p {
            color: #856404;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .contact-info {
            background-color: #f8f9fa;
            border-radius: 4px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .contact-info p {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }
        
        .contact-info strong {
            color: var(--primary);
        }
        
        .attempts-counter {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 0.5rem;
            text-align: center;
        }
        
        .features-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #555;
        }
        
        .feature-item::before {
            content: "‚úì";
            color: #27ae60;
            font-weight: bold;
            margin-right: 0.5rem;
        }
        
        .offer-link {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--accent);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        .offer-link:hover {
            background-color: #c0392b;
            transform: scale(1.05);
        }
        
        .purchase-option {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
            text-align: center;
        }
        
        .purchase-option a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .purchase-option a:hover {
            color: var(--primary);
            text-decoration: underline;
        }
        
        .loading {
            display: none;
            color: var(--secondary);
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <a href="https://homeropereira07.github.io/sismed/sismed_oferta.html" class="offer-link" target="_blank">
                üî• Oferta Especial
            </a>
            
            <div class="login-header">
                <div class="login-icon">‚öïÔ∏è</div>
                <div class="logo">Sistema de Prescri√ß√£o M√©dica</div>
                <div class="subtitle">Acesso Restrito a Profissionais de Sa√∫de</div>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Usu√°rio</label>
                    <input type="text" id="username" placeholder="Digite seu usu√°rio" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                
                <div class="error-message" id="error-message">
                    Usu√°rio ou senha incorretos. Tentativas restantes: <span id="attempts-left">3</span>
                </div>
                
                <div class="loading" id="loading">
                    Validando credenciais...
                </div>
                
                <button type="submit" id="login-button">Entrar</button>
                
                <div class="attempts-counter" id="attempts-counter">
                    Tentativa <span id="current-attempt">1</span> de 3
                </div>
                
                <div class="purchase-option">
                    <a href="https://homeropereira07.github.io/sismed/sismed_oferta.html" target="_blank">
                        Adquirir licen√ßa do sistema
                    </a>
                </div>
            </form>
            
            <div class="license-message" id="license-message">
                <h3>Licen√ßa Necess√°ria</h3>
                <p>Para acessar todas as funcionalidades do Sistema de Prescri√ß√£o M√©dica, √© necess√°rio adquirir uma licen√ßa v√°lida.</p>
                
                <div class="features-list">
                    <div class="feature-item">Prescri√ß√£o de medicamentos</div>
                    <div class="feature-item">Atestados m√©dicos</div>
                    <div class="feature-item">Receitu√°rios em branco</div>
                    <div class="feature-item">Controle especial</div>
                    <div class="feature-item">Solicita√ß√£o de exames</div>
                    <div class="feature-item">Configura√ß√£o de unidades</div>
                </div>
                
                <div class="contact-info">
                    <p><strong>Entre em contato com o desenvolvedor:</strong></p>
                    <p>üë®‚Äç‚öïÔ∏è <strong>Dr. Homero Pereira</strong></p>
                    <p>üì± WhatsApp: (98) 98602-0309</p>
                    <p>üìß Email: homeropereira@outlook.com</p>
                    <p style="margin-top: 0.75rem; text-align: center;">
                        <a href="https://homeropereira07.github.io/sismed/sismed_oferta.html" target="_blank" style="color: var(--secondary); font-weight: 500; text-decoration: none;">
                            üåü Conhe√ßa nossa oferta especial!
                        </a>
                    </p>
                </div>
            </div>
            
            <div class="footer">
                ¬© 2023 Sistema de Prescri√ß√£o M√©dica. Todos os direitos reservados.
            </div>
        </div>
    </div>

    <script>
        let loginAttempts = 0;
        const maxAttempts = 3;
        let usuarios = [];

        // Carregar usu√°rios do arquivo JSON
        async function carregarUsuarios() {
            try {
                const response = await fetch('./users.json');
                if (!response.ok) {
                    throw new Error('Erro ao carregar arquivo de usu√°rios');
                }
                const data = await response.json();
                usuarios = data.usuarios;
                console.log('Usu√°rios carregados com sucesso:', usuarios.length);
                return true;
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                // Usu√°rios padr√£o em caso de erro
                usuarios = [
                    { 
                        username: "demo", 
                        password: "medico123", 
                        nome: "Usu√°rio Demonstra√ß√£o", 
                        licenca_valida: true 
                    },
                    { 
                        username: "dr.homero", 
                        password: "sismed2023", 
                        nome: "Dr. Homero Pereira", 
                        licenca_valida: true 
                    }
                ];
                return false;
            }
        }

        // Verificar credenciais
        function verificarCredenciais(username, password) {
            const usuario = usuarios.find(user => 
                user.username === username && 
                user.password === password
            );
            
            if (usuario && usuario.licenca_valida) {
                return usuario;
            }
            return null;
        }

        // Mostrar/ocultar loading
        function toggleLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('login-button').disabled = show;
            document.getElementById('login-button').textContent = show ? 'Validando...' : 'Entrar';
        }

        document.getElementById('login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('error-message');
            const attemptsLeft = document.getElementById('attempts-left');
            const currentAttempt = document.getElementById('current-attempt');
            const licenseMessage = document.getElementById('license-message');
            
            // Mostrar loading
            toggleLoading(true);
            
            // Garantir que os usu√°rios foram carregados
            if (usuarios.length === 0) {
                await carregarUsuarios();
            }
            
            // Pequeno delay para simular processamento
            setTimeout(async () => {
                loginAttempts++;
                currentAttempt.textContent = loginAttempts;
                
                const usuario = verificarCredenciais(username, password);
                
                if (!usuario) {
                    const remainingAttempts = maxAttempts - loginAttempts;
                    attemptsLeft.textContent = remainingAttempts;
                    errorMessage.style.display = 'block';
                    
                    if (loginAttempts >= maxAttempts) {
                        document.getElementById('login-form').style.display = 'none';
                        licenseMessage.style.display = 'block';
                        document.querySelector('.subtitle').textContent = 'Licen√ßa necess√°ria para acesso';
                    }
                } else {
                    // Login bem-sucedido
                    console.log(`Bem-vindo, ${usuario.nome}!`);
                    errorMessage.style.display = 'none';
                    
                    // Redirecionar para o sistema principal
                    window.location.href = 'https://homeropereira07.github.io/sismed/';
                }
                
                // Ocultar loading
                toggleLoading(false);
            }, 1000);
        });

        // Carregar usu√°rios quando a p√°gina abrir
        document.addEventListener('DOMContentLoaded', function() {
            carregarUsuarios();
        });

        // Esconder mensagem de erro quando o usu√°rio come√ßar a digitar
        document.getElementById('username').addEventListener('input', function() {
            document.getElementById('error-message').style.display = 'none';
        });
        
        document.getElementById('password').addEventListener('input', function() {
            document.getElementById('error-message').style.display = 'none';
        });
    </script>
</body>
</html>
