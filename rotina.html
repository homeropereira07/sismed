<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisMed - Sistema de Prescrição Médica</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --accent: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }
        
        .user-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--light);
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-details:hover {
            background: var(--gray-light);
        }
        
        .user-details i {
            color: var(--primary);
        }
        
        .logout-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-top: 0.5rem;
            display: none;
            z-index: 1000;
            min-width: 200px;
        }
        
        .logout-menu.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .logout-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border: none;
            background: var(--accent);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            width: 100%;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        .sidebar {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            height: fit-content;
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .sidebar-title i {
            color: var(--primary);
        }
        
        .doc-type-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            color: var(--gray);
        }
        
        .doc-type-btn i {
            width: 20px;
            text-align: center;
        }
        
        .doc-type-btn:hover {
            background: var(--light);
            color: var(--primary);
        }
        
        .doc-type-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .content-area {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .section-title i {
            color: var(--primary);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .input-with-icon {
            position: relative;
        }
        
        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            z-index: 1;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }
        
        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .btn {
            padding: 0.9rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.2);
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #0d9665;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
        }
        
        .btn-accent {
            background: var(--accent);
            color: white;
        }
        
        .btn-accent:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(239, 68, 68, 0.2);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-new-patient {
            background: var(--warning);
            color: white;
        }
        
        .btn-new-patient:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(245, 158, 11, 0.2);
        }
        
        /* Área de impressão */
        .print-area {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            margin-top: 2rem;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .print-header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--gray-light);
            padding-bottom: 1rem;
        }
        
        .print-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .print-logo {
            max-height: 80px;
        }
        
        .print-title {
            flex-grow: 1;
            text-align: center;
        }
        
        .print-content {
            line-height: 1.8;
        }
        
        .signature-area {
            margin-top: 4rem;
            text-align: center;
        }
        
        .signature-line {
            width: 300px;
            border-top: 1px solid #333;
            margin: 0 auto;
            padding-top: 0.5rem;
        }
        
        .unidade-info {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        /* Controle especial */
        .receituario-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            font-size: 12px;
        }
        
        .via {
            width: 48%;
            border: 1px solid #333;
            padding: 10px;
            position: relative;
            font-size: 12px;
        }
        
        .via-title {
            text-align: center;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .emitente-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            font-size: 12px;
        }
        
        .prescricao-item {
            margin-bottom: 8px;
            font-size: 11px;
        }
        
        .identificacao-section {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
        }
        
        .identificacao-box {
            width: 48%;
        }
        
        .identificacao-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .data-assinatura {
            text-align: center;
            margin-top: 15px;
            font-size: 11px;
        }
        
        /* Exames */
        .exames-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .exames-categoria {
            background-color: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .categoria-title {
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--primary);
            border-bottom: 1px solid var(--gray-light);
            padding-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .exame-item {
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        
        .exame-item input {
            width: auto;
            margin-right: 0.75rem;
        }
        
        .exame-item label {
            margin-bottom: 0;
            font-weight: normal;
            cursor: pointer;
        }
        
        .lateralidade-options {
            margin-left: 20px;
            margin-top: 5px;
        }
        
        .lateralidade-select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--gray-light);
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        /* Configuração */
        .config-info {
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .config-info h3 {
            margin-bottom: 1rem;
            color: var(--primary);
        }
        
        .config-info p {
            margin-bottom: 0.75rem;
        }
        
        /* Controles de edição */
        .edit-controls {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            justify-content: center;
        }
        
        .editable-content {
            border: 1px dashed #ccc;
            padding: 15px;
            min-height: 100px;
            margin-bottom: 15px;
            border-radius: 8px;
        }
        
        .edit-mode .editable-content {
            border: 2px solid var(--primary);
            background-color: #f8f9fa;
        }
        
        .prescription-item {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .prescription-header {
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        /* Responsividade */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .content-area {
                order: 1;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .exames-container {
                grid-template-columns: 1fr;
            }
            
            .receituario-container {
                flex-direction: column;
                gap: 1.5rem;
            }
            
            .via {
                width: 100%;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .user-info {
                width: 100%;
                justify-content: center;
            }
            
            .logout-menu {
                left: 50%;
                transform: translateX(-50%);
                right: auto;
            }
            
            .form-actions, .edit-controls {
                flex-direction: column;
            }
        }
        
        /* CSS para impressão corrigido */
        @media print {
            body, html {
                background: white !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            body * {
                visibility: hidden;
                background: white !important;
                box-shadow: none !important;
            }
            
            .print-area, .print-area * {
                visibility: visible;
                background: white !important;
                box-shadow: none !important;
            }
            
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                page-break-after: avoid;
                page-break-inside: avoid;
            }
            
            .no-print, .edit-controls {
                display: none !important;
            }
            
            /* Garantir que não haja quebras de página desnecessárias */
            .receituario-container {
                page-break-inside: avoid;
            }
            
            .via {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-stethoscope logo-icon"></i>
                    <div class="logo-text">SisMed - Sistema de Prescrição Médica</div>
                </div>
                <div class="user-info">
                    <div class="user-details" id="user-menu">
                        <i class="fas fa-user-md"></i>
                        <span id="user-name">Carregando...</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="logout-menu" id="logout-menu">
                        <button class="logout-btn" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair do Sistema
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="sidebar-title">
                    <i class="fas fa-file-medical"></i>
                    Documentos Médicos
                </div>
                
                <div class="doc-type-btn active" data-type="receita">
                    <i class="fas fa-prescription-bottle"></i>
                    Receita Médica
                </div>
                
                <div class="doc-type-btn" data-type="atestado">
                    <i class="fas fa-file-contract"></i>
                    Atestado Médico
                </div>
                
                <div class="doc-type-btn" data-type="receituario">
                    <i class="fas fa-file-prescription"></i>
                    Receituário em Branco
                </div>
                
                <div class="doc-type-btn" data-type="controle-especial">
                    <i class="fas fa-capsules"></i>
                    Controle Especial
                </div>
                
                <div class="doc-type-btn" data-type="solicitacao-exames">
                    <i class="fas fa-microscope"></i>
                    Solicitação de Exames
                </div>
                
                <div class="doc-type-btn" data-type="configuracao">
                    <i class="fas fa-cog"></i>
                    Configuração
                </div>
            </div>
            
            <div class="content-area">
                <!-- Formulário para Receita -->
                <div id="receita-form" class="form-section active">
                    <h2 class="section-title">
                        <i class="fas fa-prescription-bottle"></i>
                        Receita Médica
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paciente" class="form-label">Nome do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="paciente" class="form-input" placeholder="Nome completo do paciente">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="doenca" class="form-label">Selecione a Doença/Condição</label>
                            <div class="input-with-icon">
                                <i class="fas fa-disease input-icon"></i>
                                <select id="doenca" class="form-select">
                                    <option value="">Selecione uma condição</option>
                                    <option value="LOMBALGIA">LOMBALGIA</option>
                                    <option value="DOR AGUDA">DOR AGUDA</option>
                                    <option value="AFTAS">AFTAS</option>
                                    <option value="ALERGIA">ALERGIA</option>
                                    <option value="ANEMIA MODERADA">ANEMIA MODERADA</option>
                                    <option value="CONJUNTIVITE">CONJUNTIVITE</option>
                                    <option value="CONSTIPAÇÃO">CONSTIPAÇÃO</option>
                                    <option value="CRISE HEMORROIDA">CRISE HEMORROIDA</option>
                                    <option value="DIARREIA">DIARREIA</option>
                                    <option value="DIARREIA INFECCIOSA">DIARREIA INFECCIOSA</option>
                                    <option value="DOR ABDOMINAL">DOR ABDOMINAL</option>
                                    <option value="DOR NA GARGANTA">DOR NA GARGANTA</option>
                                    <option value="EDEMA">EDEMA</option>
                                    <option value="GASTRITE">GASTRITE</option>
                                    <option value="GONORREIA 1">GONORREIA 1</option>
                                    <option value="GONORREIA 2">GONORREIA 2</option>
                                    <option value="GRIPE GESTANTE">GRIPE GESTANTE</option>
                                    <option value="GRIPE UBS">GRIPE UBS</option>
                                    <option value="INFECÇÃO PARTES MOLES">INFECÇÃO PARTES MOLES</option>
                                    <option value="INFECÇÃO TGI">INFECÇÃO TGI</option>
                                    <option value="ITU">ITU</option>
                                    <option value="ITU NORFLOXACINO">ITU NORFLOXACINO</option>
                                    <option value="LESÃO DE PELE">LESÃO DE PELE</option>
                                    <option value="METRORRAGIA">METRORRAGIA</option>
                                    <option value="ORDEOLO">ORDEOLO</option>
                                    <option value="OTALGIA">OTALGIA</option>
                                    <option value="OTALGIA INFECCIOSA">OTALGIA INFECCIOSA</option>
                                    <option value="PARALISIA FACIAL">PARALISIA FACIAL</option>
                                    <option value="PNEUMONIA E AMIGDALITE">PNEUMONIA E AMIGDALITE</option>
                                    <option value="SÍNDROME GRIPAL">SÍNDROME GRIPAL</option>
                                    <option value="SUTURA">SUTURA</option>
                                    <option value="VAGINOSE">VAGINOSE</option>
                                    <option value="VITAMINA">VITAMINA</option>
                                    <option value="VPPB">VPPB (Vertigem Posicional Paroxística Benigna)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="gerar-receita" class="btn btn-primary">
                            <i class="fas fa-file-medical"></i>
                            Gerar Receita
                        </button>
                    </div>
                </div>
                
                <!-- Formulário para Atestado -->
                <div id="atestado-form" class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-file-contract"></i>
                        Atestado Médico
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paciente-atestado" class="form-label">Nome do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="paciente-atestado" class="form-input" placeholder="Nome completo do paciente">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="dias-afastamento" class="form-label">Número de Dias de Afastamento</label>
                            <div class="input-with-icon">
                                <i class="fas fa-calendar-day input-icon"></i>
                                <input type="number" id="dias-afastamento" class="form-input" min="1" value="1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="cid" class="form-label">CID (Código Internacional de Doenças)</label>
                            <div class="input-with-icon">
                                <i class="fas fa-stethoscope input-icon"></i>
                                <input type="text" id="cid" class="form-input" placeholder="Ex: M54.5">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="gerar-atestado" class="btn btn-primary">
                            <i class="fas fa-file-contract"></i>
                            Gerar Atestado
                        </button>
                    </div>
                </div>
                
                <!-- Formulário para Receituário em Branco -->
                <div id="receituario-form" class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-file-prescription"></i>
                        Receituário em Branco
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paciente-receituario" class="form-label">Nome do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="paciente-receituario" class="form-input" placeholder="Nome completo do paciente">
                            </div>
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="medicamentos" class="form-label">Medicamentos Prescritos</label>
                            <div class="input-with-icon">
                                <i class="fas fa-pills input-icon"></i>
                                <textarea id="medicamentos" class="form-textarea" placeholder="Digite os medicamentos e suas posologias..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="gerar-receituario" class="btn btn-primary">
                            <i class="fas fa-file-prescription"></i>
                            Gerar Receituário
                        </button>
                    </div>
                </div>
                
                <!-- Formulário para Controle Especial -->
                <div id="controle-especial-form" class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-capsules"></i>
                        Receituário de Controle Especial
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="medico" class="form-label">Nome do Médico</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user-md input-icon"></i>
                                <input type="text" id="medico" class="form-input" placeholder="Nome completo do médico">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="crm" class="form-label">CRM</label>
                            <div class="input-with-icon">
                                <i class="fas fa-id-card input-icon"></i>
                                <input type="text" id="crm" class="form-input" placeholder="Número do CRM">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="endereco-medico" class="form-label">Endereço da Unidade</label>
                            <div class="input-with-icon">
                                <i class="fas fa-map-marker-alt input-icon"></i>
                                <input type="text" id="endereco-medico" class="form-input" placeholder="Endereço completo">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="paciente-controle" class="form-label">Nome do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="paciente-controle" class="form-input" placeholder="Nome completo do paciente">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="endereco-paciente" class="form-label">Endereço do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-home input-icon"></i>
                                <input type="text" id="endereco-paciente" class="form-input" placeholder="Endereço completo do paciente">
                            </div>
                        </div>
                        
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="medicamentos-controle" class="form-label">Medicamentos de Controle Especial</label>
                            <div class="input-with-icon">
                                <i class="fas fa-pills input-icon"></i>
                                <textarea id="medicamentos-controle" class="form-textarea" placeholder="Digite os medicamentos de controle especial e suas posologias..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="gerar-controle-especial" class="btn btn-primary">
                            <i class="fas fa-capsules"></i>
                            Gerar Receituário
                        </button>
                    </div>
                </div>
                
                <!-- Formulário para Solicitação de Exames -->
                <div id="solicitacao-exames-form" class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-microscope"></i>
                        Solicitação de Exames
                    </h2>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="paciente-exames" class="form-label">Nome do Paciente</label>
                            <div class="input-with-icon">
                                <i class="fas fa-user input-icon"></i>
                                <input type="text" id="paciente-exames" class="form-input" placeholder="Nome completo do paciente">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h3 class="categoria-title">
                            <i class="fas fa-check-circle"></i>
                            Selecione os Exames Solicitados
                        </h3>
                        <div class="exames-container">
                            <!-- Exames de Laboratório -->
                            <div class="exames-categoria">
                                <div class="categoria-title">
                                    <i class="fas fa-flask"></i>
                                    Exames de Laboratório
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-1" value="Hemograma completo">
                                    <label for="exame-lab-1">Hemograma completo</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-2" value="Glicemia de jejum">
                                    <label for="exame-lab-2">Glicemia de jejum</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-3" value="Glicemia capilar ou plasmática">
                                    <label for="exame-lab-3">Glicemia capilar ou plasmática</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-4" value="Perfil lipídico (colesterol total, HDL, LDL, triglicerídeos)">
                                    <label for="exame-lab-4">Perfil lipídico (colesterol total, HDL, LDL, triglicerídeos)</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-5" value="Ureia">
                                    <label for="exame-lab-5">Ureia</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-lab-6" value="Creatinina">
                                    <label for="exame-lab-6">Creatinina</label>
                                </div>
                            </div>
                            
                            <!-- Exames de Imagem -->
                            <div class="exames-categoria">
                                <div class="categoria-title">
                                    <i class="fas fa-x-ray"></i>
                                    Exames de Imagem
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-1" value="Ultrassonografia abdominal total">
                                    <label for="exame-img-1">Ultrassonografia abdominal total</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-2" value="Ultrassonografia pélvica (masculina/feminina)">
                                    <label for="exame-img-2">Ultrassonografia pélvica (masculina/feminina)</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-3" value="Ultrassonografia obstétrica">
                                    <label for="exame-img-3">Ultrassonografia obstétrica</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-4" value="Radiografia simples tórax">
                                    <label for="exame-img-4">Radiografia simples tórax</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-5" value="Radiografia simples abdome">
                                    <label for="exame-img-5">Radiografia simples abdome</label>
                                </div>
                                
                                <div class="exame-item">
                                    <input type="checkbox" id="exame-img-6" value="Eletrocardiograma (ECG)">
                                    <label for="exame-img-6">Eletrocardiograma (ECG)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoes-exames" class="form-label">Observações Adicionais</label>
                        <div class="input-with-icon">
                            <i class="fas fa-sticky-note input-icon"></i>
                            <textarea id="observacoes-exames" class="form-textarea" placeholder="Digite observações adicionais sobre os exames solicitados..."></textarea>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="gerar-solicitacao-exames" class="btn btn-primary">
                            <i class="fas fa-microscope"></i>
                            Gerar Solicitação de Exames
                        </button>
                    </div>
                </div>
                
                <!-- Formulário para Configuração -->
                <div id="configuracao-form" class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        Configuração do Sistema
                    </h2>
                    
                    <div class="form-group">
                        <label for="unidade-trabalho" class="form-label">Selecione a Unidade de Trabalho</label>
                        <div class="input-with-icon">
                            <i class="fas fa-hospital input-icon"></i>
                            <select id="unidade-trabalho" class="form-select">
                                <option value="">Selecione uma unidade</option>
                                <optgroup label="HOSPITAIS">
                                    <option value="HOSPITAL AQUILES LISBOA">HOSPITAL AQUILES LISBOA</option>
                                    <option value="HOSPITAL DA CRIANÇA DE PRESIDENTE MÉDICI">HOSPITAL DA CRIANÇA DE PRESIDENTE MÉDICI</option>
                                    <option value="HOSPITAL DA CRIANÇA E MULHER DE COLINAS">HOSPITAL DA CRIANÇA E MULHER DE COLINAS</option>
                                </optgroup>
                                <optgroup label="MATERNIDADES">
                                    <option value="MATERNIDADE BENEDITO LEITE">MATERNIDADE BENEDITO LEITE</option>
                                    <option value="MATERNIDADE DE ALTA COMPLEXIDADE DO MARANHÃO – MACMA">MATERNIDADE DE ALTA COMPLEXIDADE DO MARANHÃO – MACMA</option>
                                </optgroup>
                                <optgroup label="UNIDADES DE PRONTO ATENDIMENTO – UPAs">
                                    <option value="UPA ARAÇAGY">UPA ARAÇAGY</option>
                                    <option value="UPA CIDADE OPERÁRIA">UPA CIDADE OPERÁRIA</option>
                                    <option value="UPA PARQUE VITÓRIA">UPA PARQUE VITÓRIA</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                    
                    <div id="unidade-detalhes" class="config-info" style="display: none;">
                        <h3>Detalhes da Unidade Selecionada</h3>
                        <div id="unidade-info"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="salvar-configuracao" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Salvar Configuração
                        </button>
                    </div>
                </div>
                
                <!-- Área de Impressão -->
                <div id="print-area" class="print-area">
                    <div class="print-header">
                        <div class="print-header-content">
                            <img src="https://raw.githubusercontent.com/homeropereira07/sismed/refs/heads/main/LOGOMA.jpg" alt="Estado do Maranhão" class="print-logo">
                            <div class="print-title">
                                <h2 id="document-title">RECEITA MÉDICA</h2>
                                <p id="unidade-nome">UNIDADE DE PRONTO ATENDIMENTO</p>
                            </div>
                            <img src="https://raw.githubusercontent.com/homeropereira07/sismed/refs/heads/main/LOGOUPA.jpg" alt="Governo do Maranhão" class="print-logo">
                        </div>
                        <div id="unidade-dados" class="unidade-info">
                            <!-- Dados da unidade serão inseridos aqui via JavaScript -->
                        </div>
                    </div>
                    
                    <div class="print-content">
                        <p><strong>Paciente:</strong> <span id="print-paciente"></span></p>
                        <div id="print-content" class="editable-content" contenteditable="false">
                            <!-- Conteúdo será inserido aqui via JavaScript -->
                        </div>
                        
                        <div class="signature-area">
                            <p><strong id="print-medico-assinatura">DR. HOMERO PEREIRA</strong></p>
                            <p id="print-crm-assinatura">CRM-MA: 16XXX</p>
                            <div class="signature-line"></div>
                            <p>Assinatura do Médico</p>
                        </div>
                    </div>
                </div>
                
                <!-- Área de Impressão para Controle Especial -->
                <div id="print-area-controle-especial" class="print-area">
                    <div class="receituario-container">
                        <!-- Primeira Via (Farmácia) -->
                        <div class="via">
                            <div class="via-title">RECEITUÁRIO CONTROLE ESPECIAL</div>
                            
                            <div class="emitente-section">
                                <div class="via-title">IDENTIFICAÇÃO DO EMITENTE</div>
                                <div class="emitente-line">
                                    <span id="print-medico">HOMERO PEREIRA</span>
                                    <span>1ª VIA FARMÁCIA</span>
                                </div>
                                <div class="emitente-line">
                                    <span>Médico</span>
                                    <span>2ª VIA PACIENTE</span>
                                </div>
                                <div class="emitente-line">
                                    <span id="print-crm">CRM-MA: 16XXX</span>
                                    <span></span>
                                </div>
                                <div class="emitente-line">
                                    <span id="print-endereco-medico">Av. João Santana, 30 - Parque Vitória</span>
                                    <span></span>
                                </div>
                                <div class="emitente-line">
                                    <span>São José de Ribamar - MA, 65066-190</span>
                                    <span></span>
                                </div>
                            </div>
                            
                            <div class="paciente-section">
                                <div class="emitente-line">
                                    <span>Paciente:</span>
                                    <span id="print-paciente-controle"></span>
                                </div>
                                <div class="emitente-line">
                                    <span>Endereço:</span>
                                    <span id="print-endereco-paciente"></span>
                                </div>
                            </div>
                            
                            <div class="prescricao-section">
                                <div class="via-title">Prescrição:</div>
                                <div id="print-medicamentos" class="prescricao-item">
                                    <!-- Conteúdo será inserido via JavaScript -->
                                </div>
                            </div>
                            
                            <div class="data-assinatura">
                                <div>SÃO LUÍS - MA, <span id="print-data"></span></div>
                                <div>Médico - Carimbo</div>
                            </div>
                            
                            <div class="identificacao-section">
                                <div class="identificacao-box">
                                    <div class="via-title">IDENTIFICAÇÃO DO COMPRADOR</div>
                                    <div class="identificacao-line">
                                        <span>Nome:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Ident.:</span>
                                        <span>Órg.Emissor:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>End.:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Cidade:</span>
                                        <span>UF:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Data_____/_____/_______</span>
                                        <span></span>
                                    </div>
                                </div>
                                
                                <div class="identificacao-box">
                                    <div class="via-title">IDENTIFICAÇÃO DO FORNECEDOR</div>
                                    <div class="identificacao-line">
                                        <span>Nome:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Ident.:</span>
                                        <span>Órg.Emissor:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>End.:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Cidade:</span>
                                        <span>UF:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Data_____/_____/_______</span>
                                        <span></span>
                                    </div>
                                    <div class="assinatura-section">
                                        <span>Assinatura do Farmacêutico</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Segunda Via (Paciente) -->
                        <div class="via">
                            <div class="via-title">RECEITUÁRIO CONTROLE ESPECIAL</div>
                            
                            <div class="emitente-section">
                                <div class="via-title">IDENTIFICAÇÃO DO EMITENTE</div>
                                <div class="emitente-line">
                                    <span id="print-medico2">HOMERO PEREIRA</span>
                                    <span>1ª VIA FARMÁCIA</span>
                                </div>
                                <div class="emitente-line">
                                    <span>Médico</span>
                                    <span>2ª VIA PACIENTE</span>
                                </div>
                                <div class="emitente-line">
                                    <span id="print-crm2">CRM-MA: 16XXX</span>
                                    <span></span>
                                </div>
                                <div class="emitente-line">
                                    <span id="print-endereco-medico2">Av. João Santana, 30 - Parque Vitória</span>
                                    <span></span>
                                </div>
                                <div class="emitente-line">
                                    <span>São José de Ribamar - MA, 65066-190</span>
                                    <span></span>
                                </div>
                            </div>
                            
                            <div class="paciente-section">
                                <div class="emitente-line">
                                    <span>Paciente:</span>
                                    <span id="print-paciente-controle2"></span>
                                </div>
                                <div class="emitente-line">
                                    <span>Endereço:</span>
                                    <span id="print-endereco-paciente2"></span>
                                </div>
                            </div>
                            
                            <div class="prescricao-section">
                                <div class="via-title">Prescrição:</div>
                                <div id="print-medicamentos2" class="prescricao-item">
                                    <!-- Conteúdo será inserido via JavaScript -->
                                </div>
                            </div>
                            
                            <div class="data-assinatura">
                                <div>SÃO LUÍS - MA, <span id="print-data2"></span></div>
                                <div>Médico - Carimbo</div>
                            </div>
                            
                            <div class="identificacao-section">
                                <div class="identificacao-box">
                                    <div class="via-title">IDENTIFICAÇÃO DO COMPRADOR</div>
                                    <div class="identificacao-line">
                                        <span>Nome:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Ident.:</span>
                                        <span>Órg.Emissor:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>End.:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Cidade:</span>
                                        <span>UF:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Data_____/_____/_______</span>
                                        <span></span>
                                    </div>
                                </div>
                                
                                <div class="identificacao-box">
                                    <div class="via-title">IDENTIFICAÇÃO DO FORNECEDOR</div>
                                    <div class="identificacao-line">
                                        <span>Nome:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Ident.:</span>
                                        <span>Órg.Emissor:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>End.:</span>
                                        <span></span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Cidade:</span>
                                        <span>UF:</span>
                                    </div>
                                    <div class="identificacao-line">
                                        <span>Data_____/_____/_______</span>
                                        <span></span>
                                    </div>
                                    <div class="assinatura-section">
                                        <span>Assinatura do Farmacêutico</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Controles de Edição e Impressão -->
                <div class="no-print">
                    <div class="edit-controls" id="edit-controls" style="display: none;">
                        <button id="btn-edit" class="btn btn-secondary">
                            <i class="fas fa-edit"></i>
                            Editar Documento
                        </button>
                        <button id="btn-save" class="btn btn-secondary" style="display: none;">
                            <i class="fas fa-save"></i>
                            Salvar Alterações
                        </button>
                        <button id="btn-print" class="btn btn-accent">
                            <i class="fas fa-print"></i>
                            Imprimir Documento
                        </button>
                        <button id="btn-new-patient" class="btn btn-new-patient">
                            <i class="fas fa-user-plus"></i>
                            Novo Paciente
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dados das unidades
        const unidades = {
            "HOSPITAL AQUILES LISBOA": {
                endereco: "Av. José Sarney S/N – Ponta do Bonfim – Bairro Vila Nova, SÃO LUIS – MA",
                telefone: "(98) 3242-6902",
                horario: "24 Horas",
                especialidades: "RETAGUARDA CLÍNICA MÉDICA E CIRÚRGICA; CARDIOLOGIA; COLOPROCTOLOGIA; CIRURGIA GERAL; CLÍNICA MÉDICA; DERMATOLOGIA; ENDOCRINOLOGIA; GINECOLOGIA; MASTOLOGIA; NEUROLOGIA; ORTOPEDIA; PEDIATRIA; REUMATOLOGIA; UROLOGIA."
            },
            "HOSPITAL DA CRIANÇA DE PRESIDENTE MÉDICI": {
                endereco: "Av. Santa Teresa, s/n, Bairro Alto Alegria, PRESIDENTE MEDICI – MA, CEP: 65279-000",
                telefone: "",
                horario: "24 Horas",
                especialidades: "PEDIATRIA CLÍNICA E CIRÚRGICA."
            },
            "HOSPITAL DA CRIANÇA E MULHER DE COLINAS": {
                endereco: "Rua Rui Barbosa, 321, Centro, COLINAS – MA",
                telefone: "",
                horario: "24 Horas",
                especialidades: "GENICOLOGIA CLÍNICA E CIRÚRGICA; PEDIATRIA CLÍNICA E CIRÚRGICA."
            },
            "UPA ARAÇAGY": {
                endereco: "Av. Conselheiro Hilton Rodrigues, s/n, Bairro Araçagi, SÃO JOSÉ DE RIBAMAR – MA",
                telefone: "(98) 3226-9700 / 3246-1168",
                horario: "24 Horas",
                especialidades: "CLÍNICA MÉDICA; PEDIATRIA; ODONTOLOGIA; ORTOPEDIA."
            },
            "UPA CIDADE OPERÁRIA": {
                endereco: "Av. Principal, s/n, Bairro Cidade Operária, SÃO LUÍS – MA",
                telefone: "(98) 3247-2393",
                horario: "24 Horas",
                especialidades: "CLÍNICA MÉDICA; PEDIATRIA; ODONTOLOGIA."
            },
            "UPA PARQUE VITÓRIA": {
                endereco: "Rua José Santana, nº 20, Qd-38, Residencial Canudos, Bairro Turu, SÃO LUÍS – MA",
                telefone: "(98) 3190-8076 / 99116-1976",
                horario: "24 Horas",
                especialidades: "CLÍNICA MÉDICA; PEDIATRIA."
            },
            "MATERNIDADE BENEDITO LEITE": {
                endereco: "Av. Jerônimo de Albuquerque, s/n, Bairro Cohab Anil, SÃO LUÍS – MA",
                telefone: "(98) 98423-8793",
                horario: "24 Horas",
                especialidades: "CIRURGIA GERAL; CLÍNICA MÉDICA; OBSTETRÍCIA CIRÚRGICA; OBSTETRÍCIA CLÍNICA; PEDIATRIA CLÍNICA."
            },
            "MATERNIDADE DE ALTA COMPLEXIDADE DO MARANHÃO – MACMA": {
                endereco: "Av Jeronimo de Albuquerque, s/n, Bairro Cohab Anil, SÃO LUÍS – MA",
                telefone: "",
                horario: "24 Horas",
                especialidades: "CIRURGIA GERAL; CLÍNICA MÉDICA; OBSTETRÍCIA CIRÚRGICA; OBSTETRÍCIA CLÍNICA; PEDIATRIA CLÍNICA; CARDIOLOGIA; GASTROENTEROLOGIA; GINECOLOGIA; GENÉTICA; NEUROLOGIA; OBSTETRÍCIA; OFTALMOLOGIA; PEDIATRIA."
            }
        };

        // Dados das receitas
        const receitas = {
            "LOMBALGIA": {
                "USO ORAL": [
                    "CETOPROFENO 100MG - 01 caixa - Tomar 01 comprimido de 12/12h por 5 dias",
                    "MIOSAN CAF - 01 caixa - Tomar 01 comprimido à noite por 5 dias",
                    "DIPIRONA 1G - 01 caixa - Tomar 1 comprimido de 8/8h em caso de dor ou febre"
                ]
            },
            "DOR AGUDA": {
                "USO ORAL": [
                    "KETALGI 500 MG - 01 caixa - Tomar 01 comprimido de 12/12 horas por 05 dias",
                    "TORAGESIC 10 MG - 01 caixa - Tomar 01 comprimido sublingual se crise. Pode repetir com 2 horas",
                    "LISADOR DIP 1G - 01 caixa - Tomar 01 comprimido de 08/08h se dor ou febre"
                ]
            },
            "AFTAS": {
                "USO ORAL": [
                    "PARACETAMOL 750 MG - 01 caixa - Tomar 01 comprimido de 8/8 horas"
                ],
                "USO TÓPICO": [
                    "OMCILON-A ORABASE - 01 tubo - Aplicar de 08/08h nas lesões antes das refeições"
                ]
            },
            "ALERGIA": {
                "USO ORAL": [
                    "ALEKTOS 20 MG - 01 caixa - Tomar 01 comprimido de 12/12h por 5 dias",
                    "PREDNISOLONA 20 MG - 01 caixa - Tomar 01 comprimido de 12/12h por 5 dias"
                ]
            },
            "ANEMIA MODERADA": {
                "USO ORAL": [
                    "SULFATO FERROSO 40 MG - 01 frasco - Tomar 1 ml 1x ao dia",
                    "POLIVITAMINICO INFANTIL - 01 frasco - Tomar 1 ml 1x ao dia"
                ]
            },
            "CONJUNTIVITE": {
                "USO TÓPICO": [
                    "COLIRIO TOBRAMICINA 0,3% - 01 frasco - Aplicar 1 gota em cada olho de 6/6h por 7 dias",
                    "COLIRIO DEXAMETASONA 0,1% - 01 frasco - Aplicar 1 gota em cada olho de 6/6h por 3 dias"
                ]
            },
            "GASTRITE": {
                "USO ORAL": [
                    "OMEPRAZOL 20 MG - 01 caixa - Tomar 01 comprimido 30 min antes do café da manhã por 30 dias",
                    "DIMETICONA 75 MG - 01 caixa - Tomar 01 comprimido de 8/8h por 7 dias"
                ]
            },
            "ITU": {
                "USO ORAL": [
                    "NITROFURANTOINA 100 MG - 01 caixa - Tomar 01 comprimido de 6/6h por 7 dias",
                    "CETOPROFENO 100 MG - 01 caixa - Tomar 01 comprimido de 12/12h se dor"
                ]
            },
            "SÍNDROME GRIPAL": {
                "USO ORAL": [
                    "PARACETAMOL 750 MG - 01 caixa - Tomar 01 comprimido de 8/8h se febre ou dor",
                    "LORATADINA 10 MG - 01 caixa - Tomar 01 comprimido 1x ao dia por 5 dias",
                    "XILOMETAZOLINA 0,1% - 01 frasco - Aplicar 2 borrifadas em cada narina de 8/8h por 5 dias"
                ]
            }
        };

        // Elementos DOM
        let unidadeSelecionada = localStorage.getItem('unidadeSelecionada') || '';

        // Inicializar interface
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar se o usuário está logado
            const medicoLogado = JSON.parse(localStorage.getItem('medicoLogado'));
            
            if (!medicoLogado) {
                // Se não estiver logado, redirecionar para a tela de login
                window.location.href = 'https://homeropereira07.github.io/sismed/';
                return;
            }
            
            // Exibir nome do médico logado
            document.getElementById('user-name').textContent = medicoLogado.nome;
            
            // Configurar menu de logout
            const userMenu = document.getElementById('user-menu');
            const logoutMenu = document.getElementById('logout-menu');
            const logoutBtn = document.getElementById('logout-btn');
            
            userMenu.addEventListener('click', function() {
                logoutMenu.classList.toggle('show');
            });
            
            logoutBtn.addEventListener('click', function() {
                // Remover dados do médico do localStorage
                localStorage.removeItem('medicoLogado');
                localStorage.removeItem('dadosMedico');
                // Redirecionar para a tela de login
                window.location.href = 'https://homeropereira07.github.io/sismed/';
            });
            
            // Fechar menu ao clicar fora
            document.addEventListener('click', function(event) {
                if (!userMenu.contains(event.target) && !logoutMenu.contains(event.target)) {
                    logoutMenu.classList.remove('show');
                }
            });
            
            // Carregar dados do médico nos formulários
            carregarDadosMedico(medicoLogado);
            
            // Configuração da unidade
            const unidadeTrabalhoSelect = document.getElementById('unidade-trabalho');
            if (unidadeSelecionada) {
                unidadeTrabalhoSelect.value = unidadeSelecionada;
                mostrarDetalhesUnidade(unidadeSelecionada);
            }

            unidadeTrabalhoSelect.addEventListener('change', function() {
                const unidade = this.value;
                mostrarDetalhesUnidade(unidade);
            });

            // Botão salvar configuração
            document.getElementById('salvar-configuracao').addEventListener('click', () => {
                const unidade = unidadeTrabalhoSelect.value;
                
                if (!unidade) {
                    alert('Por favor, selecione uma unidade de trabalho.');
                    return;
                }
                
                localStorage.setItem('unidadeSelecionada', unidade);
                unidadeSelecionada = unidade;
                alert('Configuração salva com sucesso!');
            });

            // Alternar entre tipos de documento
            const docTypeButtons = document.querySelectorAll('.doc-type-btn');
            const formSections = document.querySelectorAll('.form-section');
            
            docTypeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const type = button.getAttribute('data-type');
                    
                    // Ativar botão selecionado
                    docTypeButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    // Mostrar formulário correspondente
                    formSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(`${type}-form`).classList.add('active');
                    
                    // Ocultar área de impressão
                    document.getElementById('print-area').style.display = 'none';
                    document.getElementById('print-area-controle-especial').style.display = 'none';
                    document.getElementById('edit-controls').style.display = 'none';
                });
            });

            // Botão gerar receita
            document.getElementById('gerar-receita').addEventListener('click', gerarReceita);
            
            // Botão gerar atestado
            document.getElementById('gerar-atestado').addEventListener('click', gerarAtestado);
            
            // Botão gerar receituário
            document.getElementById('gerar-receituario').addEventListener('click', gerarReceituario);
            
            // Botão gerar controle especial
            document.getElementById('gerar-controle-especial').addEventListener('click', gerarControleEspecial);
            
            // Botão gerar solicitação de exames
            document.getElementById('gerar-solicitacao-exames').addEventListener('click', gerarSolicitacaoExames);

            // Controles de edição
            document.getElementById('btn-edit').addEventListener('click', () => {
                document.getElementById('print-content').contentEditable = 'true';
                document.getElementById('print-area').classList.add('edit-mode');
                document.getElementById('btn-edit').style.display = 'none';
                document.getElementById('btn-save').style.display = 'inline-block';
            });

            document.getElementById('btn-save').addEventListener('click', () => {
                document.getElementById('print-content').contentEditable = 'false';
                document.getElementById('print-area').classList.remove('edit-mode');
                document.getElementById('btn-edit').style.display = 'inline-block';
                document.getElementById('btn-save').style.display = 'none';
            });

            // Botão imprimir
            document.getElementById('btn-print').addEventListener('click', () => {
                window.print();
            });

            // Botão novo paciente
            document.getElementById('btn-new-patient').addEventListener('click', resetarFormularios);
            
            // Controle da lateralidade para exames
            document.querySelectorAll('.exame-lateralidade').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const lateralidadeDiv = this.parentElement.querySelector('.lateralidade-options');
                    if (this.checked) {
                        lateralidadeDiv.style.display = 'block';
                    } else {
                        lateralidadeDiv.style.display = 'none';
                        lateralidadeDiv.querySelector('.lateralidade-select').value = '';
                    }
                });
            });
        });

        function carregarDadosMedico(medico) {
            // Preencher automaticamente os campos do médico nos formulários
            const camposMedico = document.querySelectorAll('#medico, #print-medico, #print-medico2, #print-medico-assinatura');
            const camposCRM = document.querySelectorAll('#crm, #print-crm, #print-crm2, #print-crm-assinatura');
            
            // Usar os dados reais do médico logado
            let nomeMedico = medico.nome || 'MÉDICO RESPONSÁVEL';
            let crmMedico = medico.crm || 'CRM: XXXXXX';
            
            // Garantir que o nome esteja em maiúsculas (padrão médico)
            nomeMedico = nomeMedico.toUpperCase();
            
            camposMedico.forEach(campo => {
                if (campo.tagName === 'INPUT') {
                    campo.value = nomeMedico;
                } else {
                    campo.textContent = nomeMedico;
                }
            });
            
            camposCRM.forEach(campo => {
                if (campo.tagName === 'INPUT') {
                    campo.value = crmMedico;
                } else {
                    campo.textContent = crmMedico;
                }
            });
            
            // Salvar dados do médico para uso nos documentos
            localStorage.setItem('dadosMedico', JSON.stringify({
                nome: nomeMedico,
                crm: crmMedico
            }));
        }

        function mostrarDetalhesUnidade(unidade) {
            const unidadeDetalhes = document.getElementById('unidade-detalhes');
            const unidadeInfo = document.getElementById('unidade-info');
            
            if (unidade && unidades[unidade]) {
                const dados = unidades[unidade];
                unidadeInfo.innerHTML = `
                    <p><strong>Endereço:</strong> ${dados.endereco}</p>
                    ${dados.telefone ? `<p><strong>Telefone:</strong> ${dados.telefone}</p>` : ''}
                    <p><strong>Horário de Funcionamento:</strong> ${dados.horario}</p>
                    <p><strong>Especialidades:</strong> ${dados.especialidades}</p>
                `;
                unidadeDetalhes.style.display = 'block';
            } else {
                unidadeDetalhes.style.display = 'none';
            }
        }

        function atualizarDadosUnidade(unidade) {
            const unidadeDados = document.getElementById('unidade-dados');
            if (unidades[unidade]) {
                const dados = unidades[unidade];
                unidadeDados.innerHTML = `
                    <p><strong>Endereço:</strong> ${dados.endereco}</p>
                    ${dados.telefone ? `<p><strong>Telefone:</strong> ${dados.telefone}</p>` : ''}
                    <p><strong>Horário de Funcionamento:</strong> ${dados.horario}</p>
                `;
            }
        }

        // Função para obter dados do médico para assinatura
        function obterDadosMedico() {
            // Primeiro tenta obter do localStorage
            const dadosSalvos = localStorage.getItem('dadosMedico');
            if (dadosSalvos) {
                return JSON.parse(dadosSalvos);
            }
            
            // Se não encontrar, tenta obter do médico logado
            const medicoLogado = JSON.parse(localStorage.getItem('medicoLogado'));
            if (medicoLogado) {
                return {
                    nome: medicoLogado.nome.toUpperCase(),
                    crm: medicoLogado.crm || 'CRM: XXXXXX'
                };
            }
            
            // Fallback para dados padrão
            return {
                nome: 'MÉDICO RESPONSÁVEL',
                crm: 'CRM: XXXXXX'
            };
        }

        // Função para resetar todos os formulários
        function resetarFormularios() {
            // Resetar formulário de receita
            document.getElementById('paciente').value = '';
            document.getElementById('doenca').value = '';
            
            // Resetar formulário de atestado
            document.getElementById('paciente-atestado').value = '';
            document.getElementById('dias-afastamento').value = '1';
            document.getElementById('cid').value = '';
            
            // Resetar formulário de receituário
            document.getElementById('paciente-receituario').value = '';
            document.getElementById('medicamentos').value = '';
            
            // Resetar formulário de controle especial
            document.getElementById('paciente-controle').value = '';
            document.getElementById('endereco-paciente').value = '';
            document.getElementById('medicamentos-controle').value = '';
            
            // Resetar formulário de exames
            document.getElementById('paciente-exames').value = '';
            document.getElementById('observacoes-exames').value = '';
            
            // Desmarcar todos os checkboxes de exames
            document.querySelectorAll('#solicitacao-exames-form input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Ocultar áreas de impressão
            document.getElementById('print-area').style.display = 'none';
            document.getElementById('print-area-controle-especial').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'none';
            
            // Voltar para a primeira aba (receita)
            document.querySelectorAll('.doc-type-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.doc-type-btn[data-type="receita"]').classList.add('active');
            
            document.querySelectorAll('.form-section').forEach(section => section.classList.remove('active'));
            document.getElementById('receita-form').classList.add('active');
            
            // Focar no primeiro campo
            document.getElementById('paciente').focus();
            
            alert('Formulários resetados. Pronto para atender um novo paciente!');
        }

        function gerarReceita() {
            const dadosMedico = obterDadosMedico();
            
            if (!unidadeSelecionada) {
                alert('Por favor, configure a unidade de trabalho primeiro.');
                return;
            }
            
            const paciente = document.getElementById('paciente').value;
            const doenca = document.getElementById('doenca').value;
            
            if (!paciente || !doenca) {
                alert('Por favor, preencha o nome do paciente e selecione uma doença.');
                return;
            }
            
            document.getElementById('document-title').textContent = 'RECEITA MÉDICA';
            document.getElementById('print-paciente').textContent = paciente;
            document.getElementById('unidade-nome').textContent = unidadeSelecionada;
            
            // Atualizar assinatura com dados do médico
            document.getElementById('print-medico-assinatura').textContent = dadosMedico.nome;
            document.getElementById('print-crm-assinatura').textContent = dadosMedico.crm;
            
            atualizarDadosUnidade(unidadeSelecionada);
            
            let contentHTML = '';
            
            if (receitas[doenca]) {
                for (const [tipoUso, medicamentos] of Object.entries(receitas[doenca])) {
                    contentHTML += `<div class="prescription-item"><div class="prescription-header">${tipoUso}:</div><ul>`;
                    
                    medicamentos.forEach(med => {
                        contentHTML += `<li>${med}</li>`;
                    });
                    
                    contentHTML += '</ul></div>';
                }
            } else {
                contentHTML += '<p>Receita não encontrada para esta condição.</p>';
            }
            
            contentHTML += `<p style="margin-top: 20px;"><strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>`;
            
            document.getElementById('print-content').innerHTML = contentHTML;
            document.getElementById('print-area').style.display = 'block';
            document.getElementById('print-area-controle-especial').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'flex';
        }

        function gerarAtestado() {
            const dadosMedico = obterDadosMedico();
            
            if (!unidadeSelecionada) {
                alert('Por favor, configure a unidade de trabalho primeiro.');
                return;
            }
            
            const paciente = document.getElementById('paciente-atestado').value;
            const dias = document.getElementById('dias-afastamento').value;
            const cid = document.getElementById('cid').value;
            
            if (!paciente || !dias || !cid) {
                alert('Por favor, preencha todos os campos do atestado.');
                return;
            }
            
            document.getElementById('document-title').textContent = 'ATESTADO MÉDICO';
            document.getElementById('print-paciente').textContent = paciente;
            document.getElementById('unidade-nome').textContent = unidadeSelecionada;
            
            // Atualizar assinatura com dados do médico
            document.getElementById('print-medico-assinatura').textContent = dadosMedico.nome;
            document.getElementById('print-crm-assinatura').textContent = dadosMedico.crm;
            
            atualizarDadosUnidade(unidadeSelecionada);
            
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            
            const numeroExtenso = {
                '1': 'UM', '2': 'DOIS', '3': 'TRÊS', '4': 'QUATRO', '5': 'CINCO',
                '6': 'SEIS', '7': 'SETE', '8': 'OITO', '9': 'NOVE', '10': 'DEZ'
            };
            
            const diasExtenso = numeroExtenso[dias] || dias;
            
            let contentHTML = `
                <p>ATESTO PARA OS DEVIDOS FINS, QUE A SR(A). <strong>${paciente}</strong> COMPARECEU A ESTA UNIDADE DIA ${dataAtual} ONDE FOI ATENDIDO, MEDICADO, NECESSITANDO DE ${dias} (${diasExtenso}) ${dias == 1 ? 'DIA' : 'DIAS'} DE AFASTAMENTO DE SUAS ATIVIDADES LABORAIS POR MOTIVO DE DOENÇA A CONTAR DA DATA DE EXPEDIÇÃO DESTE DOCUMENTO.</p>
                
                <p>ALÉM DISSO, CONFORME ART. 5º DA RESOLUÇÃO 1685/2002 DO CFM, INFORMO O DIAGNÓSTICO CODIFICADO (CID), DEVIDO A SOLICITAÇÃO DO PRÓPRIO PACIENTE, CONFORME ASSINATURA DE CONCORDÂNCIA ABAIXO.</p>
                
                <p><strong>CID: ${cid}</strong></p>
                
                <div style="margin-top: 40px;">
                    <p>_________________________________________</p>
                    <p>Assinatura de concordância do paciente para informação do CID</p>
                </div>
                
                <p style="margin-top: 30px;"><strong>Data:</strong> ${dataAtual}</p>
            `;
            
            document.getElementById('print-content').innerHTML = contentHTML;
            document.getElementById('print-area').style.display = 'block';
            document.getElementById('print-area-controle-especial').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'flex';
        }

        function gerarReceituario() {
            const dadosMedico = obterDadosMedico();
            
            if (!unidadeSelecionada) {
                alert('Por favor, configure a unidade de trabalho primeiro.');
                return;
            }
            
            const paciente = document.getElementById('paciente-receituario').value;
            const medicamentos = document.getElementById('medicamentos').value;
            
            if (!paciente || !medicamentos) {
                alert('Por favor, preencha o nome do paciente e os medicamentos.');
                return;
            }
            
            document.getElementById('document-title').textContent = 'RECEITUÁRIO MÉDICO';
            document.getElementById('print-paciente').textContent = paciente;
            document.getElementById('unidade-nome').textContent = unidadeSelecionada;
            
            // Atualizar assinatura com dados do médico
            document.getElementById('print-medico-assinatura').textContent = dadosMedico.nome;
            document.getElementById('print-crm-assinatura').textContent = dadosMedico.crm;
            
            atualizarDadosUnidade(unidadeSelecionada);
            
            let contentHTML = `
                <div class="prescription-item">
                    <p>${medicamentos.replace(/\n/g, '<br>')}</p>
                </div>
                <p style="margin-top: 20px;"><strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>
            `;
            
            document.getElementById('print-content').innerHTML = contentHTML;
            document.getElementById('print-area').style.display = 'block';
            document.getElementById('print-area-controle-especial').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'flex';
        }

        function gerarControleEspecial() {
            const dadosMedico = obterDadosMedico();
            
            const medico = document.getElementById('medico').value;
            const crm = document.getElementById('crm').value;
            const enderecoMedico = document.getElementById('endereco-medico').value;
            const paciente = document.getElementById('paciente-controle').value;
            const enderecoPaciente = document.getElementById('endereco-paciente').value;
            const medicamentos = document.getElementById('medicamentos-controle').value;
            
            if (!medico || !crm || !enderecoMedico || !paciente || !enderecoPaciente || !medicamentos) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            // Atualizar dados na primeira via
            document.getElementById('print-medico').textContent = dadosMedico.nome;
            document.getElementById('print-medico2').textContent = dadosMedico.nome;
            document.getElementById('print-crm').textContent = dadosMedico.crm;
            document.getElementById('print-crm2').textContent = dadosMedico.crm;
            document.getElementById('print-endereco-medico').textContent = enderecoMedico;
            document.getElementById('print-endereco-medico2').textContent = enderecoMedico;
            document.getElementById('print-paciente-controle').textContent = paciente;
            document.getElementById('print-paciente-controle2').textContent = paciente;
            document.getElementById('print-endereco-paciente').textContent = enderecoPaciente;
            document.getElementById('print-endereco-paciente2').textContent = enderecoPaciente;
            
            // Formatar os medicamentos com fonte menor
            document.getElementById('print-medicamentos').innerHTML = `<div style="font-size: 11px;">${medicamentos.replace(/\n/g, '<br>')}</div>`;
            document.getElementById('print-medicamentos2').innerHTML = `<div style="font-size: 11px;">${medicamentos.replace(/\n/g, '<br>')}</div>`;
            
            // Atualizar data
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            document.getElementById('print-data').textContent = dataAtual;
            document.getElementById('print-data2').textContent = dataAtual;
            
            document.getElementById('print-area').style.display = 'none';
            document.getElementById('print-area-controle-especial').style.display = 'block';
            document.getElementById('edit-controls').style.display = 'flex';
        }

        function gerarSolicitacaoExames() {
            const dadosMedico = obterDadosMedico();
            
            if (!unidadeSelecionada) {
                alert('Por favor, configure a unidade de trabalho primeiro.');
                return;
            }
            
            const paciente = document.getElementById('paciente-exames').value;
            const observacoes = document.getElementById('observacoes-exames').value;
            
            if (!paciente) {
                alert('Por favor, preencha o nome do paciente.');
                return;
            }
            
            // Coletar exames selecionados
            const examesSelecionados = [];
            const checkboxes = document.querySelectorAll('#solicitacao-exames-form input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('Por favor, selecione pelo menos um exame.');
                return;
            }
            
            checkboxes.forEach(checkbox => {
                let exameTexto = checkbox.value;
                
                // Verificar se é um exame com lateralidade
                if (checkbox.classList.contains('exame-lateralidade')) {
                    const lateralidadeSelect = checkbox.parentElement.querySelector('.lateralidade-select');
                    const lateralidade = lateralidadeSelect ? lateralidadeSelect.value : '';
                    
                    if (lateralidade) {
                        exameTexto += ` - ${lateralidade}`;
                    }
                }
                
                examesSelecionados.push(exameTexto);
            });
            
            document.getElementById('document-title').textContent = 'SOLICITAÇÃO DE EXAMES';
            document.getElementById('print-paciente').textContent = paciente;
            document.getElementById('unidade-nome').textContent = unidadeSelecionada;
            
            // Atualizar assinatura com dados do médico
            document.getElementById('print-medico-assinatura').textContent = dadosMedico.nome;
            document.getElementById('print-crm-assinatura').textContent = dadosMedico.crm;
            
            atualizarDadosUnidade(unidadeSelecionada);
            
            let contentHTML = `
                <div class="prescription-item">
                    <div class="prescription-header">Exames Solicitados:</div>
                    <ul>
            `;
            
            examesSelecionados.forEach(exame => {
                contentHTML += `<li>${exame}</li>`;
            });
            
            contentHTML += `
                    </ul>
                </div>
            `;
            
            if (observacoes) {
                contentHTML += `
                    <div class="prescription-item">
                        <div class="prescription-header">Observações:</div>
                        <p>${observacoes.replace(/\n/g, '<br>')}</p>
                    </div>
                `;
            }
            
            contentHTML += `<p style="margin-top: 20px;"><strong>Data:</strong> ${new Date().toLocaleDateString('pt-BR')}</p>`;
            
            document.getElementById('print-content').innerHTML = contentHTML;
            document.getElementById('print-area').style.display = 'block';
            document.getElementById('print-area-controle-especial').style.display = 'none';
            document.getElementById('edit-controls').style.display = 'flex';
        }
    </script>
</body>
</html>
